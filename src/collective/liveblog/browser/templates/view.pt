<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    metal:use-macro="context/main_template/macros/master"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    i18n:domain="collective.liveblog">
<body>
  <metal:block fill-slot="main">
    <article itemscope itemtype="http://schema.org/BlogPosting">
      <header>
        <div tal:replace="structure provider:plone.abovecontenttitle" />
        <h1 class="documentFirstHeading" itemprop="headline"
            tal:content="context/Title">
          Title
        </h1>
        <div tal:replace="structure provider:plone.belowcontenttitle" />
        <div class="documentDescription" itemprop="description"
            tal:content="context/Description">
          Description
        </div>
      </header>

      <div tal:replace="structure provider:plone.abovecontentbody" />
      <div id="content-core" itemprop="articleBody">

    <div tal:condition="view/can_add_microupdate">
      <h2 i18n:translate="">Add micro-update</h2>
      <form action="@@add-microupdate"
          tal:attributes="action string:${context/absolute_url}/@@add-microupdate">
        <input placeholder="Title" title="Title" name="title" size="80" i18n:attributes="placeholder; title" />
        <tal:editor define="here nocall:context;
                            portal_url nocall:context/portal_url;
                            portal portal_url/getPortalObject;
                            id nothing;
                            inputname string:text;
                            inputvalue nothing;
                            here_url request/getURL;
                            member context/portal_membership/getAuthenticatedMember;
                            tabindex nothing;
                            rows python:15">
          <div metal:use-macro="context/wysiwyg_support/macros/wysiwygEditorBox">
            The WYSIWYG code
          </div>
        </tal:editor>
        <input type="submit" value="Publish" i18n:attributes="value" />
      </form>
    </div>

    <section id="micro-updates">
      <article class="microupdate" data-timestamp="" itemprop="comment" itemscope itemtype="http://schema.org/Comment"
          tal:repeat="update view/updates"
          tal:attributes="data-timestamp update/timestamp">
        <p class="microupdate-title">
          <strong tal:content="update/title" />
        </p>
        <div class="microupdate-text" tal:content="structure update/text" />
        <p class="microupdate-byline" i18n:translate="">
          By <span itemprop="author" tal:content="update/creator" />
          <time itemprop="datePublished" title="2014-08-28 14h31" datetime="2014-08-28T14:31:02.402278"
              tal:content="update/time"
              tal:attributes="datetime update/isoformat;
                              title update/datetime" />
        </p>
      </article>
      <div class="microupdate" data-timestamp=""
          tal:condition="not:view/has_updates"
          tal:attributes="data-timestamp view/now">
        <p class="microupdate-title">
          <strong i18n:translate="">No micro-updates yet for this Liveblog.</strong>
        </p>
        <div class="microupdate-text" />
        <p class="microupdate-byline" />
      </div>
    </section>

      </div>
      <div tal:replace="structure provider:plone.belowcontentbody" />
    </article>

    <script type="text/javascript">
        setInterval(function() {
            var timestamp = $(".microupdate").attr("data-timestamp");
            $.get("updates?timestamp=" + timestamp, function(data) {
                $("#micro-updates").prepend(data).fadeIn("slow");
            });
        }, 1000 * 60);
    </script>
  </metal:block>
</body>
</html>
